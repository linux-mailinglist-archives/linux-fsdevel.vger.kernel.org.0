Return-Path: <linux-fsdevel-owner@vger.kernel.org>
X-Original-To: lists+linux-fsdevel@lfdr.de
Delivered-To: lists+linux-fsdevel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id E8C9A357299
	for <lists+linux-fsdevel@lfdr.de>; Wed,  7 Apr 2021 19:02:58 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1354483AbhDGRDG (ORCPT <rfc822;lists+linux-fsdevel@lfdr.de>);
        Wed, 7 Apr 2021 13:03:06 -0400
Received: from mail2-relais-roc.national.inria.fr ([192.134.164.83]:11009 "EHLO
        mail2-relais-roc.national.inria.fr" rhost-flags-OK-OK-OK-OK)
        by vger.kernel.org with ESMTP id S229751AbhDGRDE (ORCPT
        <rfc822;linux-fsdevel@vger.kernel.org>);
        Wed, 7 Apr 2021 13:03:04 -0400
IronPort-HdrOrdr: =?us-ascii?q?A9a23=3Aw9vIHqsa0jACAfO/1Fj7Ros27skDrtV00zAX?=
 =?us-ascii?q?/kB9WHVpW+afkN2jm+le6A/shF8qOE0ItNicNMC7K0/02oVy5eAqUIuKeCnDlC?=
 =?us-ascii?q?+WIJp57Y3kqgeOJwTb+vRG3altN4hSYeeaMXFAgcz34Ba1Hr8bqbG62Zq1juTT?=
 =?us-ascii?q?xWoFd2BXQpxnhj0WNi+mCEFsACFJCZ0lfaDx2vZ6?=
X-IronPort-AV: E=Sophos;i="5.82,203,1613430000"; 
   d="scan'208";a="502059670"
Received: from 173.121.68.85.rev.sfr.net (HELO hadrien) ([85.68.121.173])
  by mail2-relais-roc.national.inria.fr with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 07 Apr 2021 19:02:53 +0200
Date:   Wed, 7 Apr 2021 19:02:53 +0200 (CEST)
From:   Julia Lawall <julia.lawall@inria.fr>
X-X-Sender: jll@hadrien
To:     Jan Kara <jack@suse.cz>
cc:     Amir Goldstein <amir73il@gmail.com>, linux-fsdevel@vger.kernel.org,
        linux-kernel@vger.kernel.org, kbuild-all@lists.01.org,
        Denis Efremov <efremov@linux.com>
Subject: Re: [PATCH] inotify: fix minmax.cocci warnings
In-Reply-To: <20210407160546.GA3271@quack2.suse.cz>
Message-ID: <alpine.DEB.2.22.394.2104071901260.11549@hadrien>
References: <alpine.DEB.2.22.394.2104062246500.19097@hadrien> <20210407160546.GA3271@quack2.suse.cz>
User-Agent: Alpine 2.22 (DEB 394 2020-01-19)
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Precedence: bulk
List-ID: <linux-fsdevel.vger.kernel.org>
X-Mailing-List: linux-fsdevel@vger.kernel.org



On Wed, 7 Apr 2021, Jan Kara wrote:

> On Tue 06-04-21 22:49:26, Julia Lawall wrote:
> > From: kernel test robot <lkp@intel.com>
> >
> > Opportunity for min().
> >
> > Generated by: scripts/coccinelle/misc/minmax.cocci
> >
> > Fixes: 8636e3295ce3 ("coccinelle: misc: add minmax script")
> > CC: Denis Efremov <efremov@linux.com>
> > Reported-by: kernel test robot <lkp@intel.com>
> > Signed-off-by: kernel test robot <lkp@intel.com>
> > Signed-off-by: Julia Lawall <julia.lawall@inria.fr>
> ...
> > --- a/fs/notify/inotify/inotify_user.c
> > +++ b/fs/notify/inotify/inotify_user.c
> > @@ -382,7 +382,7 @@ static int inotify_add_to_idr(struct idr
> >
> >  	spin_unlock(idr_lock);
> >  	idr_preload_end();
> > -	return ret < 0 ? ret : 0;
> > +	return min(ret, 0);
> >  }
>
> Honestly, while previous expression is a standard idiom for "if 'ret' holds
> an error, return it", the new expression is harder to understand for me. So
> I prefer to keep things as they are in this particular case...

OK, I had doubts about it as well, but I forwarded it because I found them
equally obscure...

Denis, maybe the semantic patch should be updated to avoid this case.

julia
