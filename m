Return-Path: <linux-fsdevel-owner@vger.kernel.org>
X-Original-To: lists+linux-fsdevel@lfdr.de
Delivered-To: lists+linux-fsdevel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 0FF433BC198
	for <lists+linux-fsdevel@lfdr.de>; Mon,  5 Jul 2021 18:23:32 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S229771AbhGEQ0H (ORCPT <rfc822;lists+linux-fsdevel@lfdr.de>);
        Mon, 5 Jul 2021 12:26:07 -0400
Received: from smtp-out2.suse.de ([195.135.220.29]:55170 "EHLO
        smtp-out2.suse.de" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S229713AbhGEQ0G (ORCPT
        <rfc822;linux-fsdevel@vger.kernel.org>);
        Mon, 5 Jul 2021 12:26:06 -0400
Received: from relay2.suse.de (relay2.suse.de [149.44.160.134])
        by smtp-out2.suse.de (Postfix) with ESMTP id 867231FEB8;
        Mon,  5 Jul 2021 16:23:28 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=suse.cz; s=susede2_rsa;
        t=1625502208; h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
         mime-version:mime-version:  content-transfer-encoding:content-transfer-encoding;
        bh=9wmbQI2OX6X/e+Np+ZapEIxNND/E2Yhp/N4Pv7BefrE=;
        b=rZInqvnlrA0MoX2kYqMyh/AQkbi/QSTPzbjx3n9jRfoZnRjI5WYaE0S+4cTZyTxlBRWt4r
        d4YA26NWpSY8wDiQPevKYjUY0DXKf42qjIAwly2WhM4JoPRcZ7hPkNloOgQkuada139T1t
        F8A2VDYgbmoASpa7Uez+Bl9ZMxt1pWQ=
DKIM-Signature: v=1; a=ed25519-sha256; c=relaxed/relaxed; d=suse.cz;
        s=susede2_ed25519; t=1625502208;
        h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
         mime-version:mime-version:  content-transfer-encoding:content-transfer-encoding;
        bh=9wmbQI2OX6X/e+Np+ZapEIxNND/E2Yhp/N4Pv7BefrE=;
        b=o6DGDK/MN88+H4eZrci88PMwNYDYFESpRR9mn+cn8H58EDldQguBk8nrALn5AmnepzJs+w
        yS/SWeWpo0KH7FAg==
Received: from quack2.suse.cz (unknown [10.163.43.118])
        by relay2.suse.de (Postfix) with ESMTP id 71829A3BA7;
        Mon,  5 Jul 2021 16:23:28 +0000 (UTC)
Received: by quack2.suse.cz (Postfix, from userid 1000)
        id 3CC481F2C5D; Mon,  5 Jul 2021 18:23:28 +0200 (CEST)
From:   Jan Kara <jack@suse.cz>
To:     Andrew Morton <akpm@linux-foundation.org>
Cc:     <linux-fsdevel@vger.kernel.org>,
        Michael Stapelberg <stapelberg+linux@google.com>,
        <linux-mm@kvack.org>, Jan Kara <jack@suse.cz>
Subject: [PATCH 0/5] writeback: Fix bandwidth estimates
Date:   Mon,  5 Jul 2021 18:23:14 +0200
Message-Id: <20210705161610.19406-1-jack@suse.cz>
X-Mailer: git-send-email 2.26.2
MIME-Version: 1.0
X-Developer-Signature: v=1; a=openpgp-sha256; l=623; h=from:subject:message-id; bh=DqLhdy4UPcOF1ZuX1969TFdVBviX62+G4LL+t/kjhxU=; b=owEBbQGS/pANAwAIAZydqgc/ZEDZAcsmYgBg4zHIs/3N3oE1F3qFYcDXab0TKVkwzWuzYHfZ7bvT UdoQ4dGJATMEAAEIAB0WIQSrWdEr1p4yirVVKBycnaoHP2RA2QUCYOMxyAAKCRCcnaoHP2RA2T1rB/ 9v1ifEYYcMbpKOVyD5aqLbjHQsGO7w5i/Mx3x9I87shL3uy0Abj7wUbl5XqAqZLvzt+ajNI2H4cqYu SChz9DJuIjB/Bu/nI+27QSLHiYzGJS4BdPDV6xng/cSHaIBwuQACSu7IeIuP5LhxjtFNDNGYk7qbuX 1xtT0AfFGdvLW7rB07y+Y+Fxp8tr8MuxzP35LWe6+HXYk2uTqPvyFS2dpW9klY8RkGkLUQf+HrJqxs SMv8tk85amTpA3yXXIo4Si1upPvejJT4R06XoH6XMA651+3MhoWmV4YgSlbuit12EzKVjy2zZ1VPAr RcqMxN/Tp+MLwNlSjHc3H6DTgzTtwi
X-Developer-Key: i=jack@suse.cz; a=openpgp; fpr=93C6099A142276A28BBE35D815BC833443038D8C
Content-Transfer-Encoding: 8bit
Precedence: bulk
List-ID: <linux-fsdevel.vger.kernel.org>
X-Mailing-List: linux-fsdevel@vger.kernel.org

Hello,

this patch series fixes estimate of writeback throughput when device is not
fully busy doing writeback. Michael Stapelberg has reported that such
workload (e.g. generated by linking) tends to push estimated throughput down
to 0 and as a result writeback on the device is practically stalled.

The first three patches fix the reported issue, the remaining two patches
are unrelated cleanups of problems I've noticed when reading the code.

Michael, can you try whether these patches fix the problems you've observed?
I cannot trigger the "bandwidth going down" spiral with them anymore.

								Honza
